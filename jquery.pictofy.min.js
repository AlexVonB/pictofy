/*!
 * Copyright 2016 Hochschule der Medien (HdM) / Stuttgart Media University
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
!function(t){"use strict";function e(n,o){n.contents().each(function(n,r){var s=t(r);if(3===s.context.nodeType){var a=s.text(),i=a.split(/([^a-zA-Z\x7f-\xff])/),c=i.map(function(t){return/[a-zA-Z\x7f-\xff]+/.test(t)?'<span class="'+o["class"]+'">'+t+"</span>":t});s.replaceWith(c.join(""))}else e(s.not("."+o["class"]),o)})}function n(e,n,s){r(e,s).done(function(r,a){var i=n.tooltipster("content");t(i).append(o(e,r.rating,s))}).fail(function(t,e,n){console.log(e),console.log(n)})}function o(e,n,o){for(var r=t("<div>").addClass("picto-stars").append(),s=function(n){return function(){r.text("Thanks."),t.ajax({url:o.getRatingUrl(e),method:"POST",data:{rating:n},crossDomain:!0,xhrFields:{withCredentials:!0}})}},a=1;a<=5;a++){var i=t("<span>").addClass("picto-stars__star").toggleClass("picto-stars__star--empty",a>n);i.click(s(a)),r.append(i)}return r}function r(e,n){return t.ajax({url:n.getRatingUrl(e),crossDomain:!0,xhrFields:{withCredentials:!0}})}t.fn.pictofy=function(o){var r=t.extend({},t.fn.pictofy.defaults,o);e(this,r);var s=t.res(r.resUrl);return t("."+r["class"]).tooltipster({updateAnimation:null,trigger:"click",theme:"tooltipster-picto",onlyOne:!0,interactive:!0,content:r.preContent,functionReady:function(e){if("cached"==e.attr("data-picto-cached"))return!0;var o=e[0].innerHTML.toLowerCase().trim(),a=void 0===typeof AS_picsupport?r.lang:AS_picsupport.language||r.lang,i=t("<div>").addClass("picto-container");return s.queries().addQuery().addProp("http://openurc.org/ns/res#type","http://openurc.org/restypes#pictogram").addPropWithDescs("http://purl.org/dc/elements/1.1/title",o).addDesc("lang",a).complete().complete().send().done(function(o){if(o.firstResponse().numberOfResources()>0){var s=o.getVeryFirstGlobalAt();s=s.replace("http://","//");var a=o.firstResponse().firstResource().props.find(function(t){return"http://openurc.org/ns/res#name"===t.name}).value;i.append(t("<img>").attr("src",s)),e.tooltipster("content",i),n(a,e,r)}else e.tooltipster("content",r.failContent);e.attr("data-picto-cached","cached")}).fail(function(t){e.tooltipster("content",r.failContent),console.log(t.error),console.log(t.status)}),!0}}),this},t.fn.pictofy.destroy=function(e){var n=t.extend({},t.fn.pictofy.defaults,e);t("."+n["class"]).tooltipster("destroy").each(function(e,n){t(n).replaceWith(t(n).html())})},t.fn.pictofy.defaults={resUrl:"https://res.openurc.org/",getRatingUrl:function(t){return"https://picsupport.gpii.eu/rating/"+encodeURIComponent(t)},lang:"en","class":"picto-tooltip",preContent:t('<div style="height:200px;width:200px;">&nbsp;</div>'),failContent:":("}}(jQuery);